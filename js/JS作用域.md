# JS作用域对性能的影响

## 作用域

+ 作用域是变量与函数的可访问 范围，即作用域控制着变量与函数的可见性和生命周期。
+ 作用域(scope)是 JAVASCRIPT 编程中一个重要的运行机制，在 JAVASCRIPT 同步和 异步编程以及 JAVASCRIPT 内存管理中起着至关重要的作用。
+ 在 JAVASCRIPT 中，能形成作用域的有如下几点。 
        o 函数的调用
        o with语句
                ▪ with会创建自已的作用域，因此会增加其中执行代码的作用域的长度。
        o 全局作用域
        o 块级作用域(ES6中提出的)

## 作用域链

### 运行期上下文
>执行函数时会创建一个称为“运行期上下文(execution context)”的内部对象，运行期上下文定义了函数执行时的环境。每个运行期上下文都有自己的作用域链，用于标识符解析,当运行期上下文被创建时，而它的作用域链初始化为当前运行函数的[[Scope]]所 包含的对象。

>一般情况下，在运行期上下文运行的过程中，其作用域链只会被 with 语句和 catch 语句影响。

1.  with
+ 当代码运行到 with 语句时，运行期上下文的作用域链临时被改变了。一个新的可变对象 被创建，它包含了参数指定的对象的所有属性。这个对象将被推入作用域链的头部，这意 味着函数的所有局部变量现在处于第二个作用域链对象中，因此访问代价更高了。

2. catch
+ 当 try 代码块中发生错误 时，执行过程会跳转到 catch 语句，然后把异常对象推入一个可变对象并置于作用域的头 部。在 catch 代码块内部，函数的所有局部变量将会被放在第二个作用域链对象中。
``
try{
    doSomething();
}catch(ex){
    alert(ex.message); //作用域链在此处改变
}
``
+ 一旦 catch 语句执行完毕，作用域链机会返回到之前的状态。try-catch 语句在 代码调试和异常处理中非常有用，因此不建议完全避免。可以通过优化代码来减少 catch 语句对性能的影响。一个很好的模式是将错误委托给一个函数处理.
``
try{
    doSomething();
}catch(ex){
    handleError(ex); //委托给处理器方法
}
``

+ 优化后的代码，handleError 方法是 catch 子句中唯一执行的代码。该函数接收异常对象 作为参数，就可以更加灵活和统一的处理错误。由于只执行一条语句，且没有局部变 量的访问，作用域链的临时改变就不会影响代码性能了


### 为什么不建议使用 with?
1. 影响性能:
with 欺骗了词法,JavaScript引擎在编译阶段有些性能优化是依赖于能够根据代码的词法进行静态分析，并预先确定所有变量和函数的定义位置，才能在执行过程中快速的找到标识符。但如果引擎在代码中发现了 with，它只能简单地假设关于标识符位置,无法让引擎做到真正的优化,因此会降低了性能.

2. 减低代码的安全性:
with 它会在你不知的情况下把一些内部作用域声明的函数或者变量泄露到其他作用域.
3. 代码更加难于阅读

